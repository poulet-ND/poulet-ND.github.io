<!DOCTYPE html>


<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S'entrainer pour les maths</title>
  </head>
  <body>
    <h1>Calcul Continu</h1>
    <p id="question"></p>
    <p id="answer"></p>
    <div id="buttons" class="button_container">
    <!--All button to tap the words-->
    <button onclick="add_num(1);" style="grid-column: 1;">1</button>
    <button onclick="add_num(2);" style="grid-column: 2;">2</button>
    <button onclick="add_num(3);" style="grid-column: 3;">3</button>
    <button onclick="enter();" style="grid-row: span 2; grid-column: 4; height: 150px;">Enter</button>
    <br>
    <button onclick="add_num(4);" style="grid-column: 1;">4</button>
    <button onclick="add_num(5);" style="grid-column: 2;">5</button>
    <button onclick="add_num(6);" style="grid-column: 3;">6</button>
    <br>
    <button onclick="add_num(7);" style="grid-column: 1;">7</button>
    <button onclick="add_num(8);" style="grid-column: 2;">8</button>
    <button onclick="add_num(9);" style="grid-column: 3;">9</button>
    <br>
    <button class="o" onclick="add_num(0);" style="grid-column: 2;">0</button>
    <button onclick="remove_num();" style="grid-column: 3;">❌</button>
    </div>
  </body>
  <style>
    body {
        justify-items: center;
        align-items: center;
        place-items: center;
    }
    h1, p{
        text-align: center;
    }
    button {
      color:green;
      width: 50px;
      height: 50px;
      border-radius: 10%;
    }
    .o {
      color:blue;
    }
    .button_container {
        display: grid;
        gap: 0px
        align-items: center;
        place-items: center;
        grid-auto-columns:0fr;/* no space between the buttobs */
        grid-auto-rows:0fr;
        justify-content: center;
        grid-template-rows: repeat(3, 1fr);
    }
    </style>
    <script>
        let operations = ["+","-","*","/"];
        let UI_operation_sign = {"+":"➕", "-":"➖", "*":"✖", "/":"➗"}
        let operations_limit = [800, 800, 15, 15];
        let question = [];
        let current = 0;
        let divisors_list = [];

        let question_text = document.getElementById("question");
        let answer_text = document.getElementById("answer");
        let users_answer = " ";
        
        let correct_answer = 0;
        
        // functions
        function rdInt(max){
            return Math.floor(Math.random() * max);
        }

        function divisors(num){
            let diviseurs = [];
            for (let i = 2; i <= Math.sqrt(num); i++) {
                if (num % i === 0) {
                    diviseurs.push(i);
                    if (i !== num / i) {
                        diviseurs.push(num / i);
                    }
                }
            }

            // sort divisors
            diviseurs.sort((a, b) => a - b);
            return diviseurs;
        }

        function create_a_question() {
            current = rdInt(4); // Choisit une opération aléatoire
            let firstNumber = rdInt(operations_limit[current]);
            let secondNumber;

            // Cas particulier pour la division
            if (operations[current] === "/") {
            divisors_list = divisors(firstNumber);
                if (divisors_list.length > 0) {
                        secondNumber = divisors_list[rdInt(divisors_list.length)];
                } else {
                    // Si aucun diviseur n'est trouvé, on recommence
                    create_a_question();
                }
            } else {
                secondNumber = rdInt(operations_limit[current]);
            }

            // Construction du tableau `questiob`
            question=[firstNumber, operations[current], secondNumber];

            // Affichage de la question
            question_text.textContent = question[0] + " " + UI_operation_sign[question[1]] + " " + question[2];
            
            // creation de la reponse correcte
            correct_answer = eval (question_text.textContent) ;// what?
        }

        function update_users_answer() {
            answer_text.textContent = users_answer;
        }

        function add_num(num) {
            users_answer += String(num);
            update_users_answer();
        }
    
        function remove_num(){
            if (users_answer.length > 1){
                users_answer = users_answer.substring(0, -1);
                update_users_answer();
            } else {
                users_answer = " ";
                update_users_answer();
            }
        }
        
        function enter(){
            if (users_answer===String(correct_answer)){
                answer_text.style.color="green";
            } else {
                answer_text.style.color="red";
                users_answer = correct_answer;
            }
            wait(3);
            create_a_question();
            // reinitialize the answer text
            answer_text.style.color = "black";
            users_answer = "0";
            update_users_answer();
        }

        create_a_question();

    </script>
</html>
